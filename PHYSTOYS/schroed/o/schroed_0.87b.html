<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <title>Schr&ouml;dinger's Toy - version 0.87 - June 11, 2010 - developing. L. Kocbach, Bergen</title>
 <style type="text/css"><!--
      #container { position: relative; }
      #DRAW_AREA { border: 1px solid #000; }
    --></style>
<!-- The tricks are invented by ROBO Design
 * http://www.robodesign.ro   -->	

<script language="JavaScript"> 
// -------------------------------------------------------------------------------------
  var TheCanvas;                                     // *** THE VARIABLES, JAVASCRIPT
  var ctx;
  var width=750;  var rwidth=635; var height=550;    // *** GENERAL CANVAS PART
// -------------------------------------------------------------------------------------

var HTML_of_MoreTexts = " ";   //    HTML manipulation - the last div-window's contents

// Global energy variables; Moved here in version 0.7
var En=(-1.0026555727455); var E6=1.0/6.0; var Fscale=1.0; var deltaE=0;
var tempEn=(-1.0);  var Energy=[]; var Nsaved=0;
var started_examples = 1; //  this shows the original message about removing saved energies

var output_string="";  var sepp=""; // This is the output string container;

function init () {                         //  Function init:   Initialization sequence.
   // Find the canvas element.
     TheCanvas = document.getElementById('DRAW_AREA');
   // Get the 2D canvas context.
     ctx = TheCanvas.getContext('2d');
	   ctx.lineWidth = 1;
	 ctx.fillStyle = '#FFFFFF';   ctx.fillRect(0, 0, width, height); 
	 draw_energy_pad();
  // Attach the mousedown, mousemove and mouseup event listeners.
    TheCanvas.addEventListener('mousedown', ev_canvas, false);
    TheCanvas.addEventListener('mousemove', ev_canvas, false);
    TheCanvas.addEventListener('mouseup',   ev_canvas, false);
    
   // ******************************************************************** 
   document.onkeydown = function(event)           //   init:  KEYBOARD EVENTS  KEYBOARD 
    {
      var keyCode; 
      if(event == null){
        keyCode = window.event.keyCode; }
      else    {
        keyCode = event.keyCode;  }
		Handle_keyboard(keyCode)
    }

// ***********************************************************   CANVAS MOUSE 
// The general-purpose event handler. This function just determines the mouse 
// position relative to the canvas element.

function ev_canvas (ev) {
  if (ev.layerX || ev.layerX == 0) { // Firefox
      ev._x = ev.layerX;
      ev._y = ev.layerY;
    } else if (ev.offsetX || ev.offsetX == 0) { // Opera
      ev._x = ev.offsetX;
      ev._y = ev.offsetY;
    }   

    // Call the event handler of the tool.
    var func = ThePencil[ev.type];
    if (func) {
      func(ev);
    }
 
 }

var ThePencil = new tool_pencil();

}   //  This is the whole init function               END OF  INIT  FUNCTION          


// ***********************************************************   CANVAS MOUSE PENCIL
// ***********************************************************   RAW DRAWING DISABLED 
  // This was a painting tool - works like a drawing pencil which tracks the mouse 
  // movements.

function tool_pencil () 
{                                                   //  Pencil start
    var thistool = this;
    thistool.started = false; 
	var Ycalc=0;
    //   MOUSEDOWN   = PEN_DOWN
    thistool.mousedown = function (ev) {
       // ctx.beginPath();                          // disabled raw pencil function
        ctx.moveTo(ev._x, ev._y);
		XmouseDOWN=ev._x; YmouseDOWN=ev._y;
        thistool.started = true; BUTTONdown=1;
           Handle_Mouseclick(); //  This is the mouse steering
		   respond_mouse();		//  This is only diagnostics	
    };
    //   MOUSEMOVE   = MOVE_TO
    thistool.mousemove = function (ev) {
      if (thistool.started) {
       // ctx.lineTo(ev._x, ev._y);                      // disabled raw pencil function
       // ctx.stroke();                                  // disabled raw pencil function
		XmouseMOVED=ev._x; YmouseMOVED=ev._y; 
		Handle_Mouseclick();    //  This is the mouse steering
		   respond_mouse(); 	//  This is only diagnostics
      }
    };
    //   MOUSEUP   =  PEN_UP
    thistool.mouseup = function (ev) {
      if (thistool.started) {
       // thistool.mousemove(ev);
		XmouseUP=ev._x; YmouseUP=ev._y; BUTTONdown=0;
        thistool.started = false;
		   Handle_Mouseclick(); //  This is the mouse steering
		   respond_mouse();   	//  This is only diagnostics
      }
    }; 
}
//    These event variables are treated by   Handle_Mouseclick();
//    XmouseMOVED  YmouseMOVED ;  XmouseDOWN   YmouseDOWN ; XmouseUP  YmouseUP ;  BUTTONdown 
</script>
</head>
<!--  
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
          Here starts the HTML -arrangement of the actual Schroedinger's Toy
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
-->
<body bgcolor = "#FFBBCC">
<div style="font-family: Helvetica,Arial,sans-serif;"> 
<small>
<b>Schr&ouml;dinger's Toy - version 0.87 June 11th, 2010 - debugging JavaScript.</b>
&nbsp; &nbsp; &nbsp;
<span style="background-color: rgb(255, 255, 55);">
This is not working in Microsoft's Internet Exploader.
</span>     <br></small>


<div id="helpPar" style="font-family: Helvetica,Arial,sans-serif;"> 

       <!--    HELP TEXT   SPACE   --> 

<small><a href="javascript:help_fun()">Help and Information</a></small>; &nbsp; 
<small>See also <a href="http://web.ift.uib.no/AMOS/resonance/">
http://web.ift.uib.no/AMOS/resonance/</a>
and also <b> Schr&ouml;dinger's Toy Gallery <a href="http://web.ift.uib.no/AMOS/schroedgallery/">
http://web.ift.uib.no/AMOS/schroedgallery/</a> </b></small>
</div> 			

<div id="container"   style="position: relative;">
<!--   ---------------------------------------------------------------------------  -->
<table>                          <!--    THE HTML IS ARRANGED IN A TABLE   -->
<!--   ---------------------------------------------------------------------------  -->
<tr>
<td> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </td>
<td>
<div id="EnergyView" style="font-family: Helvetica,Arial,sans-serif;">   <!--  EnergyView    -->

       <!--    ENERGY VIEW POSITION  --> 
	   
</div> 
<!--   -------------------------     THE CANVAS             ------------------  -->
        
<canvas id="DRAW_AREA" style="position: relative" width="750" height="550 border: 3px solid #000"></canvas>

<!--   ---------------------------------------------------------------------------  -->
</td>
<td> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </td>
<td valign="top" style="font-family: Helvetica,Arial,sans-serif;">
<small>
<!--   ---------------------------------------------------------------------------  -->
            <b>Keyboard control</b>
<!--   ---------------------------------------------------------------------------  -->
<br>
<a href="javascript:key_e()">
<b>e</b>  erase screen</a> <br>
<a href="javascript:key_l()">
<b>l</b>  light blue screen</a> <br>
<a href="javascript:key_h()">
<b>h</b>  fade the screen 50%</a><br>
<a href="javascript:key_s()">
<b>s</b>  save present energy</a> <br>
<a href="javascript:key_r()">
<b>r</b>  remove saved energies</a> <br>
<a href="javascript:key_w()">
<b>w</b>  write parameters</a> <br>
<a href="javascript:key_d()">
<b>d</b>  default parameters</a> <br>
<span style="background-color: rgb(255, 255, 55);">
<a href="javascript:key_f()">
<b>f</b>  fading on / off</a> <br> </span>
<a href="javascript:key_o()">
<b>o</b>  old slow browser</a> <br>
<a href="javascript:key_p()">
<b>p</b>  do potential shape V<b>p</b>ot</a><br>
<a href="javascript:key_b()">
<b>b</b>  do perturbation <b>B</b>arrier</a> <br>
<a href="javascript:key_g()">
<b>g</b>  done potential <b>G</b>o on</a><br>
<a href="javascript:key_g()">
<b>_</b>  also SPACE BAR</a> when done<br>
<a href="javascript:cursor_left()">
-&gt; arrow: stretch  x</a><br>
<a href="javascript:cursor_right()">
&lt;- arrow: shrink x</a><br>
<a href="javascript:cursor_up()">
UP arrow: stretch  y</a><br>
<a href="javascript:cursor_down()">
DOWN arrow: shrink y</a><br>

&nbsp; &nbsp; <br>
&nbsp; &nbsp; <br>
<b>Changing energy: </b>   <br>
&nbsp; &nbsp; 1.  &nbsp; click in the potential <br>
&nbsp; &nbsp;&nbsp; &nbsp; large changes, not precise <br>
&nbsp; &nbsp; 2.  &nbsp; click in the right area <br>

&nbsp; &nbsp;&nbsp; &nbsp; more to the right - finer <br>
&nbsp; &nbsp;&nbsp; &nbsp; red - increase <br>
&nbsp; &nbsp;&nbsp; &nbsp; blue - decrease <br>
&nbsp; &nbsp;&nbsp; &nbsp; smaller changes close to<br>
&nbsp; &nbsp;&nbsp; &nbsp; the red-blue border<br>
&nbsp; &nbsp;&nbsp; &nbsp; larger changes close to<br>
&nbsp; &nbsp;&nbsp; &nbsp; the upper and lower <br>
&nbsp; &nbsp;&nbsp; &nbsp; window frame
 <br>
 
 </small> 
				<div id="SavedEnergies" style="font-family: Helvetica,Arial,sans-serif;"> <!--  EnergyView    -->
				<!--    ENERGY LIST   SPACE  --> 
				</div>         

</td>
</tr>
<tr>
<td> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </td>
<td>    
<div id="EventView" style="font-family: Helvetica,Arial,sans-serif;">   <!--  EventView    -->
</div>
<div id="ExtraView"  style="font-family: Helvetica,Arial,sans-serif;">  <!-- Can be used diagnostics -->
<form name="OurInputWindow">
      <small>
       <br><b>Executables:</b>  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
	    <a href="javascript:execute_commands(1)">Execute the commands below and draw</a> 
		&nbsp;&nbsp;
		<a href="javascript:execute_commands(0)">Only execute the commands</a>
	   <br></small>
       <textarea style="font-family: monospace"  name="Executables" cols="90" rows="10">     
       //   This text area is editable and executable (click one of the above)
       //   The double slash means comment - not execute; remove the slashes to execute
       fade_alpha=0.03;  
       //  En=(-1.0026555727455);  solveSchroed();  display_Energy();
       //  Vpot_depth=(0.3);   
       plotPOTENTIAL(dR)    
	   //  document.getElementById("MoreTexts").innerHTML= "";   
	   //  HTML_of_MoreTexts = document.getElementById("MoreTexts").innerHTML;   
       //  document.getElementById("MoreTexts").innerHTML= ""; 
       //  document.getElementById("MoreTexts").innerHTML= HTML_of_MoreTexts ; 
   
      
      </textarea>
    <br>
     <small>
       <br><b>Program Outputs:</b> 
	   Copy and paste to your computer (use editor, mail, etc)
	   <br></small>	   
       <textarea style="font-family: monospace"  name="Outputs" cols="90" rows="10">
        This area will be filled when adjusting potential
      </textarea>	  
      <small>
	  <br>
       <br><b>Examples:</b>  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
	   Copy the text and paste it to Executables; press Only Execute there;
	   or 
	   <a href="javascript:eval(OurInputWindow.Examples.value);">just execute here</a>	    
	   <br></small>
       <textarea style="font-family: monospace"  name="Examples" cols="90" rows="10"> 
       //    Execute this without draw - draw erases screen
       key_r();   
	   Vpot_depth=1.5;
       Edge=1.4;    Steep=0.15;
       sepp="===================================";
       Perturb=1;     Vpert=2.7994545454545454; 
       PertPos=1.7773333333333334;     PertWidth=0.9424000000000001; 
       sepp="===================================";
       Nsaved=5;
       Energy[0]=0.7939763271387807;  Energy[1]=1.98718532688595; 
       Energy[2]=-1.4347905102971015;  Energy[3]=-0.98212982166903035;
       Energy[4]=  -0.219480685;	   	   
           for (ks=0; ks< Nsaved; ks=ks+1 ) { Add_Link_Energy( ks );}   
       key_e();key_h();
       sepp="===================================";
       for (Enk= 0.777;Enk<0.812;Enk=Enk+(0.812-0.777)/30) {En=Enk;  solveSchroed(); }
       DoSavedEnergy( 0 );        
      </textarea>	  
 </form>   
</div>
<!-- This   div  MoreTexts  will be erased away and restored 
   
   var HTML_of_MoreTexts = " ";
   
   HTML_of_MoreTexts = document.getElementById("MoreTexts").innerHTML;   
   document.getElementById("MoreTexts").innerHTML= ""; 
   document.getElementById("MoreTexts").innerHTML= HTML_of_MoreTexts ; 
   
-->
<div id="MoreTexts"  style="font-family: Helvetica,Arial,sans-serif;">  <!-- Can be used diagnostics -->

  <form name="MoreWindow">
  	   <a href="javascript:eval(    MoreWindow.Inputs.value   );">Execute lines below</a>
	   <br>	
		<textarea style="font-family: monospace"  name="Inputs" cols="90" rows="10">
	    key_r();               	  
		Vpot_depth=1.5;
		Edge=0.6696;    Steep=0.18186666666666662;
		sepp="===================================";
		Perturb=1;     Vpert=3.4742253139550288; 
		PertPos=1.7773333333333334;     PertWidth=0.49599999999999955; 
		sepp="===================================";
		Nsaved=5;
		Energy[0]=-1.19567377534377324;  Energy[1]=-0.2118743791151857;   
		Energy[2]=0.4189544521788905;  Energy[3]=1.2354796746318064;  
		Energy[4]=2.3366382062546465;  
		for (ks=0; ks< Nsaved; ks=ks+1 ) { Add_Link_Energy( ks );} 
		key_e();		
 
        </textarea>
  </form>
</div>
</td>
<td> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  
</td>
</tr>
</table>
</div>



<!--  
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
          Here starts the actual program of Schroedinger's Toy
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
-->
<script language="JavaScript">
  
  var  Action='none';  
  //  
  // 
  //    GEOMETRY of DRAW_AREA
  //

  var OriginX=30;
  OriginY=height/2;  
  var Xmax=6;   var Ymax=2.5;
  var Xmin=-0.2; var Ymin=-2.7;
  var Xdivide=5;  //  will be adjusted below - depends on rwidth
  var Xscale = (Xmax-Xmin)/width; var Yscale =  (Ymax-Ymin)/height;
  Xdivide = (rwidth - OriginX ) * Xscale;

  var XmouseDOWN=0; var YmouseDOWN=0; var XmouseMOVED=0; var YmouseMOVED=0; 
  var XmouseUP=0; var YmouseUP=0; var BUTTONdown=0;
  var TheKeyboard=0;
  //   math coordinate system counterparts of 
  //  XmouseDOWN   YmouseDOWN ; XmouseMOVED  YmouseMOVED ;  XmouseUP  YmouseUP ;
  // 
  var Xdown=0; var Ydown=0; var Xmoved=0;   var Ymoved=0; var Xup=0; var Yup=0;
  
  XmouseDOWN=0; YmouseDOWN=0;XmouseMOVED=0; YmouseMOVED=0; 
  XmouseUP=0;YmouseUP=0;BUTTONdown=0;  

  //  
  //     x_canv  positions on canvas  
  //     X_math  positions in Mathematical space
  //
  //	 X_math=( x_canv - OriginX ) * Xscale;
  //	 Y_math=( -y_canv + OriginY ) * Yscale;
  //
  //	 X_math / Xscale +  OriginX =  x_canv ;
  //	 Y_math / Yscale -  OriginY = -y_canv ;  
  //
  //	 x_canv =   X_math / Xscale +  OriginX ;
  //	 y_canv = - Y_math / Yscale +  OriginY  ;

  //     Xdivide = (rwidth - OriginX ) * Xscale;
  
/* The tricks are invented by ROBO Design
 * http://www.robodesign.ro   */

var ColorsSaved=[]; 
ColorsSaved[0]='#00a'; ColorsSaved[1]='#f5f';
ColorsSaved[2]='#cc0';  ColorsSaved[3]='#0a0';
ColorsSaved[4]='#8f8';  ColorsSaved[5]='#f5a';
ColorsSaved[6]='#0ff';  ColorsSaved[7]='#088';
ColorsSaved[8]='#5aa';  ColorsSaved[9]='#aa5';

    var fading=1;  var fade_alpha=0.04;  var fade_counter=0; var fading_text="  Fading is on";
    
var Event_Output=" ";

//   Variables used in adjusting potential function Vpot
//	
var old=0;
var Adjusting=0;   //  This  is set 1 when adjusting the potentials (and 2 for bump)	  
var Adjusting_Steep=0; var Adjusting_Edge=0; var StartSteep=0; var StartEdge=0;	  

var Adjusting_width_Left=0;	var Adjusting_width_Right=0;
var Adjusting_Vpert=0; var Adjusting_Pos=0;	

 var Perturb=0;
 var Vpert=0;  var PertPos=0; var PertWidth=1; var PertLeft=0; var PertRight=0; var PertPI=1;
 PertLeft=PertPos-PertWidth/2;  PertRight=PertPos-PertWidth/2; PertPI=Math.PI/PertWidth;
 
init();


//
//    It does the help and info functions                                HELP   
//
//    A variable part of the page is added -     look for  div id= helpPar
//    The helpPar changes on clicks
//
var  Help_String=
   "<small><b>JavaScript Canvas Implementation of Schr&ouml;dinger's Toy; Work: " + 
   " <a href=\"http://web.ift.uib.no/%7Eladi/\">L. Kocbach</a></b> <br>" + 
   "<small><br><b>Acknowledgement:</b> "+
   "For mouse interaction I have modified basic pencil tricks from <a href=\"http://www.robodesign.ro/\">http://www.robodesign.ro/</a> "+
    "via Opera development. <br>"+ "I have also taken some tricks from "+
	"Bj&ouml;rn Lindberg's <a href=\"http://blobsallad.se/\">http://blobsallad.se/</a></small> <br><br>"+

      "This is a re-incarnation of 1993 Macintosh Schr&ouml;dinger's Toy<br> <a href=\"http://web.ift.uib.no/AMOS/resonance/\">" + 
      "http://web.ift.uib.no/AMOS/resonance/</a> "+
	  "<br>   This time the program is contained in the page - this is all JavaScript. See the <a href=\"http://web.ift.uib.no/AMOS/schroed/sources.html\">sources.html</a><br>"+
	  "<br>There is no compilation, no software necessary. <br>"+
	  "Just take the source of the page and change the behaviour to suit your teaching and learning.<br>"+
	  "The code is moderately well documented - and there are also available older versions - "+
	  "  <a href=\"http://web.ift.uib.no/AMOS/schroed/versions.html\">versions.html</a>" +
	  "<br>"+
	  "which are somewhat simpler and might be easier to start with if you would change the program. <br>"+
	  "See also <b> Schr&ouml;dinger's Toy Gallery <a href=\"http://web.ift.uib.no/AMOS/schroedgallery/\">"+
       "http://web.ift.uib.no/AMOS/schroedgallery/</a> </b> <br>"+

      "<br><b>To play Schr&ouml;dinger's Games </b><br>"+
	  "<br>Now we start with pre-defined solutions. Remove all that by pressing <br>"+
	  "'r' followed by 'e'. Key or link 'r' to remove the stored energies, 'e' to erase screen. <br>"+
	  "Now you can try to find the energies by clicking into the potential area <br>"+
	  "or do finer and finer changes of energy clicking on the red/blue pads. <br>"+
	  "The value of energy is shown in the yellowish field above. <br>"+
	   "You can even enter the energy by text in the 'Executables' field. <br>"+
	   "Note that there are two ways to execute the 'Executables' field. <br>"+	  
	   "</small><tt>En=(-1.0026555727455);  solveSchroed();  display_Energy();</tt><small> <br>"+

	  
	    "<br><b>Why are there no proper buttons and no nice round edges and better design?</b> <br>"+
	"Beacause I am a physicist and not a Google engineer. This should be <br>"+
	"<i> as simple as possible, but not simpler </i> as Einstein would say.	<br>"+
	
	"This is not about <i>user experience</i> but hopefully about <i>user's understanding.</i> <br>"+
	"<b>Please, notice the list of keyboard commands on the right part of the screen</b><br>"+
	  
          "<br><b>What can you do with Schr&ouml;dinger's Toy?</b> <br>"
          
         +"The page solves Schr&ouml;dinger Equation.  It is a toy which Schr&ouml;dinger would have loved to have in 1927!<br> "   +  
     "<br>You can select the energy by mouse-button pressed in the drawing on the scale defined by the potential.;&nbsp; &nbsp; &nbsp; <br>"+
     "<br>Then it is like a moon-landing game: <br>"+
	 "you are supposed to find an energy value which makes the wavefunction "+
	 " go to zero at large distances. <br>Usually it does not. It blows upwards or downwards. "  +
	 "<br>"+
	 "This version contains example solutions in saved energies - see the links; try them;<br>"+
	 "<b>Hint:</b> hit the <b>r</b>-key to remove the example solutions!<br>"+
	 "<br>The energy reading in the potential area is not sufficiently precise. <br>Therefore we have one more input "+
	 " of the <b>energy values: in the red/blue fields</b> to the right.<br>" +
	 " Clicking here changes the value of <i>energy upwards in the red part, downwards in the blue part.</i> <br>" +
	 "The <b>further up in red or down in blue gives larger change.</b> <br>"+ 
	 " The changes are <big>largest to the left</big> and <small>smallest to the right.</small> <br>" +
	 "The dE just added is shown next to the energy above the drawing area (only when relevant)<br>"  + 
	 "<b>Accidental great functionality improvement</b><br>"+
	 "I made an error in version 4 and so now we have an extra feature: dragging the mouse, <br>" +
	 "or moving it with button pressed. It keeps the same value of dE, but repeats and repeats.<br>" +
  
	  "<a href=\"javascript:close_help_area()\">Close this view</a><br>" +
		  
	 "<br><br> <b>Saving - i.e. remembering the 'good energies'</b><br>" +
	 "When you have found best possible value (there are often small tails left),  <br>" +
	 "press  <b>s</b> letter key. The value as a link appears to the right. <br>" +
	  "When you click on it later, only this solution is shown with yellowish background. <br>" +
	  "Otherwise, all the saved solutions are shown when clear screen or blu screen is used.  <br>" +
	 " To remove all the saved energies, press letter  <b>r</b>  .<br>" +
	 
	 
	 "<br> <b>Changing the shape of the potential:</b><br>" +
     "Press the  <b>v</b>letter key on the keyboard. This brings a new screen with the potential<br>"+
	 " and two small squares. Drag any of the two (with mouse down) and you will see the changes. <br> " +
	 "  <span style=\"background-color: rgb(255, 255, 55);\"> "  +    //   background color 
	 " For old and slow browsers and machines: before this, pres <b>o</b> for <b>O</b>ld <br>"+
	 " </span> " +
	 " When you are done, press space bar or letter <b>g</b>.<br>"+
	 
	 "<br> <b>Adding a peaked peturbation to the shape of the potential:</b><br>" +
	 "Press letter <b>p</b> to enter this mode. <br>" +
	 "Basically the same as the potential, but now you have four squares to drag.<br>" +
	 "Usually, start with the one on the potential and drag it upwards. <br>" +
	 "The remaining three move the peak and change the width.<br>" +
	 " When you are done, press again space bar or letter <b>g</b>.<br>"+	
 
	  "<a href=\"javascript:close_help_area()\">Close this view</a><br>" +
			 
	 "<br> <b>Study of the resonances</b><br>" +	   
      "See the description at <a href=\"http://web.ift.uib.no/AMOS/resonance/1996.html\">" + 
      "http://web.ift.uib.no/AMOS/resonance/1996.html</a> <br>"+
	  "When you have a barier, you can find positive values of energy when the solution  <br>"+
	  "behaves nearly as a bound state: it gets small outside of the barrier.  <br>"+
	 	 
	"<br><b>Fading and zooming. </b><br>"+ 
	
		"Zooming - both x-axis (distance) and y-axis (function normalization) are separately zoomable.<br>"+ 
		"The cursor keys are used - left - right for x-axis, up - down for y-axis <br>" +
		"Fading can be nice and it can be annoying. Switch it on and off.<br>"+
		" Fading state is indicated close to the energy above the diagram. " +		
		 
          "<br>Saving the pictures? <br>"+
          "In Firefox and related browsers - just right-click and save the image.<br>"+
          "Or take a screen-shot. Easy on Linux and Apple Mac<br>"+
          "Normal saving of graphics: Perhaps a next version - it needs an external library.<br>"+

"<br> <b>Saving and loading of  'good studies'</b><br><br>" +
	 "<br>In version 0.85 I have added several inputs and outputs, text arrays below <br>" +  
	 "the graphics area. The Ouput window reacts to key 'w' and displays all <br>" +  
	 "the parameters important for the state of the toy. The shape parameters <br>" +  
	 "of the potential, the extra barrier, and the saved energies. <br>" +  
	 "<br>Procedure:  <br>" +  
	 "You worked out a nice example of 4 bound states and one resonance. To keep it, <br>" +  
	 "together with all the potential parameters and the saved energies,<br>" +	 
	 "press  'w'  or click on the w-link. In output window below you have<br>" +          
	 "all the necessary numbers. <br>" + 
     "Select the whole contant of the window, copy it and save it somewhere <br>" + 
	 "on your computer (paste it to editor, into an email, mail it to me,  <br>" +  
	 "save it to a text file. <br>" +  	 	 
	 "<br>Getting the case back into the Toy: <br>" +  				
	 "<br>Find the text file or the mail where you have saved that nice example. <br>" +  
	 "Copy it in your clipboard (ctrl C or command C on Mac <br>" +
	 "and paste it into the content of the 'Executables' window <br>" +
	 "Then click on 'Execute the commands below and draw' and you are back.<br>" +
	 "<br>Pre-programmed cases <br>" +
	 "<br>By now, there are 3 cases in this file: the default, 'd'-key, 3 levels; <br>" +
     "second, there is a whole resonance case shown in the window 'Examples'	<br>" +	
	 "third, there is a very interesting case in the last experimental window 	<br>" +
	 "<br>Exercise: 	<br>" +
	 "<br>Modify the text of 'Example' to show the energetically higher resonance, 	<br>" +
	 "that has a much more visible resonance width. 	<br>" +
	 "You will need </small><tt>DoSavedEnergy( 1 );</tt><small> instead of </small><tt>DoSavedEnergy( 0 );</tt><small>	<br>" +
	 "and you must modify the parameters of the loop over </small><tt>Enk</tt> <small>	<br>" +
	 				              
   "<br>  You can also modify the whole program - the program is in the page - 	<br>" +
   " it might be a good start to learn JavaScript - it is quite easy after a while<br>"+

	 "<br><b>The program and the Toy 	</b><br>" +
   
	"<br>You might have noticed that I have chosen to use the links instead of buttons, <br> "+
	"even in the most primitive blue-underline form.  <br> "+
	"This because the links are much simpler. Simple to program, simple to use.<br><br>"+
	
	"The file contains mostly javascript, but also some HTML.  <br>"+
	"It starts by HTML heading, followed by initialization Javascript.  <br>"+
	"Then comes the HTML-part - with the examples etc. look search for 'body' to find it  <br>"+
	"Next 'body' gives you the start of the main chunk of JavaScript  <br>"+
	"You can find some pearls of functions which you might like to try.  <br>"+
	"In the 'Executables' window. Have fun! <br>"+
	
	 "<br><b>Copying, re-use, re-distribution.</b><br>" +	
	 "<br>Please, propagate and copy this, mail it use it for any purpose. <br>" + 
	 "Instead of copyright, it would be nice if you would keep the links to me <br>" + 
	 "and also to the people from whom I have copied some of the tricks. <br>" + 
	 "I will not be happy if you would try to build a business on this <br>" + 
	 "but then - probably you will not succeed. This is for fun and learning. <br>" + 
     " <br>" +
	 "Have fun! For me this toy is addictive, therefore I also make <a href=\"http://web.ift.uib.no/AMOS/kepler/\" target=\"newwin\">Kepler's Toy</a> <br>" + 
	 "and have even plans for Kepler's Game <br>" + 		
	"<br><b>This help text can be closed   "  + "</b> <br> </small>";

     
var Help_Link=
        "<small><a href=\"javascript:help_fun()\">Help and Information</a> &nbsp;</small></b>"+
                  "<small>See also <a href=\"http://web.ift.uib.no/AMOS/resonance/\">" + 
                   "http://web.ift.uib.no/AMOS/resonance/</a> " +
				   
              " and also <b> Schr&ouml;dinger's Toy Gallery <a href=\"http://web.ift.uib.no/AMOS/schroedgallery/\">"+
              "http://web.ift.uib.no/AMOS/schroedgallery/</a> </b></small>";				   
				   
var Help_Output=" ";


function help_fun()
{
Help_Output="<br><hr><small><a href=\"javascript:close_help_area()\">Close this view</a></small></b>"
                      +  "<br><br>"+Help_String;
Help_Output=Help_Output+"<small><br><a href=\"javascript:close_help_area()\">Close this view</a></small><b><hr><b></b>";
         
document.getElementById("helpPar").innerHTML= Help_Output;                  
}


function close_help_area()
{
document.getElementById("helpPar").innerHTML= Help_Link;  
}


// -------------------------------------------------------------------------------------
// Variables for Ruku                                      ***   Variables for Ruku
// Runge Kutta for 2. order ODE - Schroedinger type
//
// R are the R-values
// F are function values   
// G are 1. derivative values
//  
   var Rold=0;  var Fold=0; var Fnew=0; var Gold=0;  var  Gnew=0; 
   var Rmid=0;  var Gmid=0; var Fmid=0; var Vpotmid=0;   
   var Akg=[]; var Akf=[]; var Rkf=[];
   Akg[0]=0;
   Rkf[1]=1.0;
   Rkf[2]=0.5;
   Rkf[3]=0.5;
   Rkf[4]=1.0;
   
   var dR=0.005;
   var InvMass = 22.0;   //   WILL NOT BE CHANGED
   var Edge=1.4; var Steep=0.15;   
   var Vpot_depth=1.5;      
   
    var Opd=6;   //   For the old browsers
    var OdR=dR;
   
// -----------------------------------------------------------------------
  var Mufact=0 ; var Efact=0;    //  Variables for the energy adjustment
   
  var WaveBase=1.0;              //  Variables for the drawing of functions
  var Ebase=-1.0;
  
//   Activate the Present Energy view   "EnergyView"
//
var To_Output="<span style=\"background-color: rgb(255, 255, 55);\">";   
To_Output=To_Output+"<small>E= "+  En ;   
To_Output=To_Output + " &nbsp; &nbsp;  &nbsp; &nbsp; " +fading_text ;
To_Output=To_Output + " &nbsp; &nbsp; <b>Hint:</b> hit the <b>r</b>-key to remove the example solutions!"
+ "</small><br></span>";

document.getElementById("EnergyView").innerHTML= To_Output;  

//   Activate the Saved energies view
//
         
var sortlink= "&nbsp;[ <a href=\"javascript:sort_energies()\">sort</a> ]";

var To_Energies="<br><small><b>Saved energies</b> &nbsp; "+ sortlink;
document.getElementById("SavedEnergies").innerHTML= To_Energies+"</small>";  
// -----------------------------------------------------------------------




//   var Edge=2.0; var Steep=0.2;       THIS ACTIVATES THE PROGRAM
//                                      ALL ELSE RESPONSE TO USER

//     Here is the first solution          

Draw_Plotting();
plotPOTENTIAL(dR);
solveSchroed(); 

//    Now we start with solved problem:   3 energies pre-saved 
//-1.4358655542595054
// -1.0026555727455
// -0.359966418603295
           started_examples = 1;
           Nsaved=3;  
		   Energy[0]=(-1.4358655542768247); Energy[1]=-1.0026555727455; Energy[2]=-0.359966418603295; 
           for (ksaved=0; ksaved< Nsaved; ksaved=ksaved+1 ) 
		   {
                DoSavedEnergy( ksaved );
				Add_Link_Energy( ksaved );		  
		   }


 Vpert=0;  PertPos=Edge; PertWidth=1; 
 PertLeft=PertPos-PertWidth/2;  PertRight=PertPos+PertWidth/2; PertPI=Math.PI/PertWidth;



//      TEST OF EVAL - to be replace later

           
Defaults_T=             "     En=(-1.4358655542768247);      Fscale=1.0;      ";
Defaults_T=Defaults_T + "    Vpot_depth=1.5; Edge=1.4;   Steep=0.15;           ";
Defaults_T=Defaults_T + "     Vpert=0;  PertPos=Edge; PertWidth=1;         ";
Defaults_T=Defaults_T + "             ";
Defaults_T=Defaults_T + "    ctx.fillStyle = '#FFFFFF';     ctx.fillRect(0, 0, rwidth, height);    ";	
Defaults_T=Defaults_T + "             ";
Defaults_T=Defaults_T + "     Nsaved=3;      started_examples = 1;               "; 
Defaults_T=Defaults_T + "     To_Energies=\"<br><b><small>Saved energies</b>\" + sortlink;    ";  
Defaults_T=Defaults_T + "  Energy[0]=(-1.4358655542768247); Energy[1]=-1.0026555727455; Energy[2]=-0.359966418603295;"; 
Defaults_T=Defaults_T + "  for (ksaved=0; ksaved< Nsaved; ksaved=ksaved+1 ) {         ";
Defaults_T=Defaults_T + "    DoSavedEnergy( ksaved );	  ";	 
Defaults_T=Defaults_T + "	 Add_Link_Energy( ksaved );   }   ";        
Defaults_T=Defaults_T + "    Draw_Plotting();         plotPOTENTIAL(dR);   ";
Defaults_T=Defaults_T + "             ";


function Add_Link_Energy(num_e)
{
     To_Energies=To_Energies+"<br>"+"<a href=\"javascript:DoSavedEnergy(" + num_e + ")\">(A)</a>  &nbsp;" +
	 
					"<a href=\"javascript:goEnergy(" + num_e + ")\">"  +  Energy[num_e]  + "</a> &nbsp;" +
					"<a href=\"javascript:delete_energy(" + num_e + ")\">[X]</a>  &nbsp;";  	

           document.getElementById("SavedEnergies").innerHTML= To_Energies+"</small>";
		   
    // To_Energies=To_Energies+"<br>"+"<a href=\"javascript:goEnergy(" + num_e +
		    //             ")\">"  +  Energy[num_e]  + "</a> &nbsp;" +	
			//			 "<a href=\"javascript:DoSavedEnergy(" + num_e + ")\">(A)</a> ";  		   
		   

}




function draw_energy_pad()
{
//                      The energy adjusment red-blue pad drawn
//
ctx.fillStyle = '#FF6666';   
ctx.fillRect(rwidth, 0, width, height/2); 

ctx.fillStyle = '#9999FF';   
ctx.fillRect(rwidth, height/2, width, height); 

}
//                               FROM HERE RESPONSE TO USER clicks and keys
// -----------------------------------------------------------------------
//
  
function Mline( xs, ys, xe, ye)      //   Line drawing in the Math coordinate system
    {  var xs_canv; var xe_canv;
	   var ys_canv; var ye_canv; 
  	   xs_canv = Math.ceil(   xs / Xscale +  OriginX );
  	   ys_canv = Math.ceil( - ys / Yscale +  OriginY ); 
  	   xe_canv = Math.ceil(   xe / Xscale +  OriginX );
  	   ye_canv = Math.ceil( - ye / Yscale +  OriginY ); 
       // document.write( "<br>");
       // document.write( xs_canv," &nbsp; &nbsp;", 
       // ys_canv, " &nbsp; &nbsp;", xe_canv," &nbsp; &nbsp;", ye_canv);

	   ctx.beginPath();	
	   ctx.moveTo( xs_canv, ys_canv );
	   ctx.lineTo( xe_canv, ye_canv );
	   ctx.stroke();	        	   	   
     }

// -----------------------------------------------------------------------
//
function Draw_Plotting()       //    Draw the basic lines for plotting
      {
		   Mline(0,Ebase,Xdivide,Ebase);   
		   Mline(0,WaveBase,Xdivide,WaveBase);
		   for ( xtick=1; xtick<Xdivide; xtick=xtick+1)
		       {
			     Mline(xtick,Ebase,xtick,Ebase+0.1); 
				 Mline(xtick,WaveBase,xtick,WaveBase+0.1);
			   }		   
           Mline(0,-2.5,0,Ebase+0.5);  Mline(0,WaveBase-1.3,0,WaveBase+1.4);
           Mline(Xdivide,-3,Xdivide,3);
      }
	  
// -----------------------------------------------------------------------
//
function solveSchroed()
{ 
if (fading==1) do_fading(fade_alpha, false);
Mline(0,Ebase+En,Edge+3*Steep,Ebase+En);
var iteri=0;
Fold=Fscale*(1.0-dR*dR);
//  Fold=0;
Rold=0;
Gold=0;
         for(iteri=0;iteri<100000;iteri++)
          {
             Ruku();
			 Mline(Rold,WaveBase+Fold,Rold+dR,WaveBase+Fnew);
             Rold=Rold+dR;
             Fold=Fnew;
             Gold=Gnew;

      
//             Npoints++;
//             Xfelt[Npoints-1]=Ix;
//             Yfelt[Npoints-1]=Iy;
            
//             cdec=' ';  cdec=DoItAll();
             
//             if (cdec != ' ') {  ALLREADY = TRUE; break; }
                      

		   if ( Rold > Xdivide || (Math.abs(Fnew) > 4.0  ) )  break;
         }

}




	  
	function key_f()
	{	  
          fading = !fading;
	  fading_text="  Fading is off";
	  if (fading) {fading_text="  Fading is on";}
	  
	  To_Output="<span style=\"background-color: rgb(255, 255, 55);\">";  
	  To_Output=To_Output +"<small>E= "+  En ;          
	  if (Math.abs(deltaE) > 0.000000000000000001)
	       {To_Output=To_Output + " &nbsp;  dE=" + deltaE; }
	  To_Output=To_Output + " &nbsp; &nbsp;  " +fading_text ;
	  if (  started_examples == 1 ){
	  To_Output=To_Output + " &nbsp; &nbsp; <b>Hint:</b> hit the <b>r</b>-key to remove  example solutions!";}	  
	      To_Output=To_Output + "</small><br></span>";
          document.getElementById("EnergyView").innerHTML= To_Output; 	
	}
	function key_e()
	{   
	        ctx.fillStyle = '#FFFFFF'; 
            ctx.fillRect(0, 0, rwidth, height); 
			workspace();
	}			
	function key_l()
	{     
	        ctx.fillStyle = '#DDDDFF'; 
            ctx.fillRect(0, 0, rwidth, height);  
			workspace();
	}
			
	function workspace()
	{      
	       Entemp=En;
           Draw_Plotting();
           plotPOTENTIAL(dR);    Action='none';  
		   RedoSavedEnergies();
		   En=Entemp;
		   solveSchroed();  
		   display_Energy();
		   draw_energy_pad();
	}
	function key_d()
	{     
          eval(Defaults_T); 
		  key_e();
	}

	function key_s()
	{     
		   Energy[Nsaved]=En; 
           DoSavedEnergy( Nsaved );		 
		   Add_Link_Energy( Nsaved );
		   Nsaved=Nsaved+1;  Action='none'; handle_outputs();	
	}
	function key_r()
	{     
		   Nsaved=0;            started_examples = 0;
		   To_Energies="<br><b><small>Saved energies</b>" + sortlink;           
		   document.getElementById("SavedEnergies").innerHTML= To_Energies+"</small>";
		   Action='none'; handle_outputs(); 	
	}
	function key_b()
	{     
       Adjust_perturb();
	}
	
	function key_h()
	{     
          do_fading(0.7, true);
	}

	function key_p()
	{     
		  Adjust_potential_Vpot();
	}
	function key_w()
	{     
          handle_outputs();
	}	  
	function key_o()
	{     
          old=1;
	}
	function key_g()
	{     
		    Finish_Vpot();		  
	}			  
		  
function cursor_left()
{
		  rescale_x(1.25);    draw_energy_pad();
}
function cursor_right()
{
		  rescale_x(1/1.25);  draw_energy_pad();
}		  
function cursor_up()
{
		  rescale_y(1.25);	draw_energy_pad();
}
function cursor_down()
{
		  rescale_y(1/1.25); draw_energy_pad();	
}		  
		  
				  	  
// -----------------------------------------------------------------------
// -------------         BEGIN   KEYBOARD RESPONSE FUNCTION   ------------
// -----------------------------------------------------------------------
// -----------------------------------------------------------------------
//
function Handle_keyboard(keyCode)
   {
      Action='none';
      var TESTING=0;
	  if ( TESTING ){
	  Event_Output=Event_Output + " Last pressed key code is " + keyCode +  "<br>";
	  document.getElementById("EventView").innerHTML= Event_Output+ "</small><br>";  	}  
  		
      switch(keyCode)
      {        
	  //    KEYBOARD handlings
	  //
        case 69:            //  e for  erase 
		  key_e();
          break; 
        case 76:          //    L  for light blue
          key_l();
          break; 
        case 68:          //    d  for defaults
          key_d();
          break;   
        case 83:          //    s   for save
          key_s();
          break; 
        case 87:          //    w   for write parameters
          key_w();
          break; 		  
        case 79:          //    o   old browsers
          key_o();
          break; 		  
        case 70:          //    f   fading
		  key_f();
          break; 
        case 72:          //    h half erase
          key_h();
          break; 
        case 66:          //    b   for barrier
          key_b();		 
          break; 		  
        case 82:          //    r   for remove
          key_r();
          break; 
		  
        case 80:           //  p for potential
		  key_p();
          break; 
        case 32:            //  space  for leaving potential adjusts key_g()
		  key_g();
          break; 
        case 71:            //  g  for go
		  key_g();
          break; 
        case 37:            //  <-  zoom out x-axis	
		  cursor_left();	  
		  break;
        case 39:            //  ->  zoom in	x-axis
		  cursor_right();	  
		  break;
		case 38:            //   ^ up   arrow  zoom in y-axis
		  cursor_up();	
		  break;		
		case 40:            //   v down arrow  zoom out y-axis
		  cursor_down();			
		  break;		  
        default: 		
          break;  
      }
		   
    }
// -----------------------------------------------------------------------
// -------------            END  KEYBOARD RESPONSE FUNCTION   ------------
// -----------------------------------------------------------------------

// -------------            BEGIN  MOUSE  RESPONSE FUNCTION   ------------
// -----------------------------------------------------------------------
    function Handle_Mouseclick()
	  {
		if ( (XmouseDOWN < rwidth) && Adjusting==0  )
		  {
		  //	 Y_math=( -y_canv + OriginY ) * Yscale;
		  Ycalc= ( -YmouseDOWN + OriginY ) * Yscale;
		  //  Ycalc= Ebase+En
		  En=Ycalc-Ebase;
		  deltaE=0;
		  solveSchroed();
		  }

		if ( (XmouseDOWN > rwidth) && Adjusting==0 && BUTTONdown )
		  {
		   if ( (Math.abs(XmouseDOWN-XmouseMOVED)>0) || (Math.abs(YmouseDOWN-YmouseMOVED)>0) )
		    {
		     Efact=0.1*Math.exp( -(XmouseDOWN - rwidth)/5 );
		     Mufact=2*( (height -YmouseDOWN)-height/2 )/height;
		     En=En+Mufact*Efact; deltaE=Mufact*Efact;
		     solveSchroed();
		    }
		  }	
	         
	//	  Here ends the normal solutions
	//    Here starts the potential adjustment
		  
     //     BUTTONdown 		  	  
     //   math coordinate system counterparts of 
	 //  XmouseDOWN   YmouseDOWN ; XmouseMOVED  YmouseMOVED ;  XmouseUP  YmouseUP ; 
     //   var Xdown=0; var Ydown=0; var Xmoved=0;   var Ymoved=0; var Xup=0; var Yup=0;

	   if (  Adjusting==1 )
	      {   
		  // Event_Output= Adjusting_Edge +" " + Adjusting_Steep +" " +Adjusting +" " + Edge + Xdown  + Ydown;
          //  document.getElementById("ExtraView").innerHTML= Event_Output + "<br>"; 
		  
		  
		  Xdown= ( XmouseDOWN - OriginX ) * Xscale; 
		  Ydown=( -YmouseDOWN + OriginY ) * Yscale; 
		  Xmoved=( XmouseMOVED - OriginX ) * Xscale;    
		  Ymoved=( -YmouseMOVED + OriginY ) * Yscale;
		  Xup=( XmouseUP - OriginX ) * Xscale; 
		  Yup= ( -YmouseUP + OriginY ) * Yscale;
          if (  BUTTONdown==1 && Adjusting_Steep==1 )
		      {
			   // set color to background;
			   ctx.strokeStyle = '#4ff';			   
			   OdR=dR; if(old) {OdR=Opd*dR;} ; plotPOTENTIAL(OdR); 
			   // set color to foreground
			   ctx.strokeStyle = '#000';			   
			   Steep= Xmoved - Edge;          //   Xdown-(Edge+Steep)=0
               if (Steep < 0.0001) {Steep=0.0001;}	
               if (Steep > 2.5) {Steep=2.5;}				   	
			   OdR=dR; if(old) {OdR=Opd*dR;} ; plotPOTENTIAL(OdR);			   			   	   
			  }
          if (  BUTTONdown==1 && Adjusting_Edge==1 )
		      {
			   // set color to background;
			   ctx.strokeStyle = '#4ff';
			   OdR=dR; if(old) {OdR=Opd*dR;} ; plotPOTENTIAL(OdR); 
			   // set color to foreground
			   ctx.strokeStyle = '#000';
			   Edge= Xmoved;               //   Xdown-(Edge)=0
               if (Edge < 0.3) {Edge = 0.3;}	
               if (Edge > 4.5) {Edge = 4.5;}				   	
			   OdR=dR; if(old) {OdR=Opd*dR;} ; plotPOTENTIAL(OdR);			   			   	   
			  }
			  
		//   when button released, we are done for the moment
			  
          if ( BUTTONdown==0 ) 
		      { 
	           ctx.fillStyle = '#4ff'; 
               ctx.fillRect(0, 0, rwidth, height); 
			   Draw_Plotting();  			   
			   plotPOTENTIAL(dR);				   	  			  
			  Adjusting_Edge=0; Adjusting_Steep=0; 
	          plotSquare(Edge, Ebase-Vpot_depth/2);
	          plotSquare(Edge+Steep, Ebase-0.25*Vpot_depth);				  
			  }
			  
		  if ( BUTTONdown==1 && Math.abs(Xdown-(Edge+Steep))<0.18 
		        && Math.abs(Ydown-(Ebase-0.25*Vpot_depth)) < 0.18  )
				{
				 Adjusting_Steep=1; StartSteep=Steep; StartEdge=Edge;
				}
		  if ( BUTTONdown==1 && Math.abs(Xdown-(Edge))<0.18 
		        && Math.abs(Ydown-(Ebase-0.5*Vpot_depth)) < 0.18  )
				{
				 Adjusting_Edge=1; StartSteep=Steep; StartEdge=Edge;
				}		  		  
	      }
	
		
	   if (  Adjusting==2 )
	      {   
		  Xdown= ( XmouseDOWN - OriginX ) * Xscale; 
		  Ydown=( -YmouseDOWN + OriginY ) * Yscale; 
		  Xmoved=( XmouseMOVED - OriginX ) * Xscale;    
		  Ymoved=( -YmouseMOVED + OriginY ) * Yscale;
		  Xup=( XmouseUP - OriginX ) * Xscale; 
		  Yup= ( -YmouseUP + OriginY ) * Yscale;
          if (  BUTTONdown==1 &&  Adjusting_width_Left==1 )
		      {
			   // set color to background;
			   ctx.strokeStyle = '#ff4';			   
			   OdR=dR; if(old) {OdR=Opd*dR;} ; plotPOTENTIAL(OdR); 
			   // set color to foreground
			   ctx.strokeStyle = '#000';			   
			   PertWidth = 2* ( PertPos-Xmoved);
			   PertLeft=PertPos-PertWidth/2;  PertRight=PertPos+PertWidth/2; PertPI=Math.PI/PertWidth;          
               if (PertWidth < 0.1) {PertWidth=0.1;}	
               if (PertWidth > 2.5) {PertWidth=2.5;}				   	
			   OdR=dR; if(old) {OdR=Opd*dR;} ; plotPOTENTIAL(OdR);			   			   	   
			  }
          if (  BUTTONdown==1 &&  Adjusting_width_Right==1 )
		      {
			   // set color to background;
			   ctx.strokeStyle = '#ff4';			   
			   OdR=dR; if(old) {OdR=Opd*dR;} ; plotPOTENTIAL(OdR); 
			   // set color to foreground
			   ctx.strokeStyle = '#000';			   
			   PertWidth = 2*( Xmoved-PertPos);
			   PertLeft=PertPos-PertWidth/2;  PertRight=PertPos+PertWidth/2; PertPI=Math.PI/PertWidth;          
               if (PertWidth < 0.1) {PertWidth=0.1;}	
               if (PertWidth > 2.5) {PertWidth=2.5;}				   	
			   OdR=dR; if(old) {OdR=Opd*dR;} ; plotPOTENTIAL(OdR);			   			   	   
			  }

          if (  BUTTONdown==1 && Adjusting_Pos==1 )
		      {
			   // set color to background;
			   ctx.strokeStyle = '#ff4';
			   OdR=dR; if(old) {OdR=Opd*dR;} ; plotPOTENTIAL(OdR); 
			   // set color to foreground
			   ctx.strokeStyle = '#000';
			   PertPos= Xmoved;  
			   PertLeft=PertPos-PertWidth/2;  PertRight=PertPos+PertWidth/2; PertPI=Math.PI/PertWidth;             
               if (PertPos < 0.1) {PertPos = 0.1;}	
               if (PertPos > 4.5) {PertPos = 4.5;}				   	
			   OdR=dR; if(old) {OdR=Opd*dR;} ; plotPOTENTIAL(OdR);			   			   	   
			  }
	       if (  BUTTONdown==1 && Adjusting_Vpert==1 )
		      {
			   // set color to background;
			   ctx.strokeStyle = '#ff4';
			   OdR=dR; if(old) {OdR=Opd*dR;} ; plotPOTENTIAL(OdR); 
			   // set color to foreground
			   ctx.strokeStyle = '#000';
			   Vpert= Ymoved - (Ebase+Vpot0(PertPos));               
               if (PertPos < 0.1) {PertPos = 0.1;}	
               if (PertPos > 4.5) {PertPos = 4.5;}				   	
			   OdR=dR; if(old) {OdR=Opd*dR;} ; plotPOTENTIAL(OdR);			   			   	   
			  }

			  		  
		//   when button released, we are done for the moment
			  
          if ( BUTTONdown==0 ) 
		      { 
	           ctx.fillStyle = '#ff4'; 
               ctx.fillRect(0, 0, rwidth, height); 
			   Draw_Plotting();  			   
			   plotPOTENTIAL(dR);				   	  			  
               Adjusting_width_Left=0;	Adjusting_width_Right=0;
               Adjusting_Vpert=0; Adjusting_Pos=0;	
 
	           plotSquare(PertPos, Ebase-Vpot_depth);
	           plotSquare(PertLeft, Ebase-Vpot_depth);	 plotSquare(PertRight, Ebase-Vpot_depth); 
	           plotSquare(PertPos, Ebase+Vpot(PertPos)  );				  
			  }
		if( Adjusting_width_Left==0 && Adjusting_width_Right==0 && Adjusting_Pos==0 && Adjusting_Vpert==0)
		  {
		  if ( BUTTONdown==1 && Math.abs(Xdown-(PertLeft) )<0.12 
		        && Math.abs(Ydown-(Ebase-Vpot_depth)) < 0.18  )
				{ Adjusting_width_Left=1; }
		  if ( BUTTONdown==1 && Math.abs(Xdown-(PertRight) )<0.12 
		        && Math.abs(Ydown-(Ebase-Vpot_depth)) < 0.18  )
				{ Adjusting_width_Right=1; }				
				
		  if ( BUTTONdown==1 && Math.abs(Xdown-PertPos)<0.1 
		        && Math.abs(Ydown-(Ebase-Vpot_depth)) < 0.18  )
				{ Adjusting_Pos=1; }
		  if ( BUTTONdown==1 && Math.abs(Xdown-PertPos)<0.12 
		        && Math.abs(Ydown-(Ebase+Vpot(PertPos) )) < 0.18  )
				{ Adjusting_Vpert=1; }				
		  }
	  }
		// Vpert=0;  PertPos=Edge; PertWidth=1; 
        // PertLeft=PertPos-PertWidth/2;  PertRight=PertPos+PertWidth/2; PertPI=Math.PI/PertWidth;		
		
	    display_Energy();
	}
// -----------------------------------------------------------------------
// -------------            END  MOUSE RESPONSE FUNCTION   ------------
// -----------------------------------------------------------------------
// -----------------------------------------------------------------------

function display_Energy()
{
	  To_Output="<span style=\"background-color: rgb(255, 255, 55);\">";  
	  To_Output=To_Output +"<small>E= "+  En ;             
	  if (Math.abs(deltaE) > 0.000000000000000001)
	       {To_Output=To_Output + " &nbsp;   dE=" + deltaE; }
	  To_Output=To_Output + " &nbsp; &nbsp; " +fading_text;
	  if (  started_examples == 1 ){
	       To_Output=To_Output + " &nbsp; &nbsp; <b>Hint:</b> hit the <b>r</b>-key to remove example solutions!";}
	   To_Output=To_Output +  "</small><br> </span>";
        document.getElementById("EnergyView").innerHTML= To_Output; 
}


  function rescale_x(xFACT)
        {
	        ctx.fillStyle = '#FFFFFF'; 
            ctx.fillRect(0, 0, rwidth, height);
            Xmax=Xmax * xFACT;  Xscale = (Xmax-Xmin)/width;
            Xdivide = (rwidth - OriginX ) * Xscale;
            Draw_Plotting();
            plotPOTENTIAL(dR);
		    //   RedoSavedEnergies();			
            solveSchroed();
		}

  function rescale_y(yFACT)
        {
	        ctx.fillStyle = '#FFFFFF'; 
            ctx.fillRect(0, 0, rwidth, height);
            Draw_Plotting();
            plotPOTENTIAL(dR);
			Fscale=Fscale*yFACT;
		    //  RedoSavedEnergies();			
            solveSchroed();
		}



function  Adjust_potential_Vpot()
    {  Adjusting = 1;
	   oldNsaved=Nsaved; 
	   Nsaved=0;
	   ctx.fillStyle = '#4ff'; 
       ctx.fillRect(0, 0, rwidth, height); 	   
       Draw_Plotting();   //  var Vpot_depth=1.5;   AND REMAINS CONSTANT
       OdR=dR; if(old) {OdR=Opd*dR;} ; plotPOTENTIAL(OdR);   // Original var Edge=2.0; var Steep=0.2;  
	   plotSquare(Edge, Ebase-Vpot_depth/2);
	   plotSquare(Edge+Steep, Ebase-0.25*Vpot_depth);	    	   
	}
function Finish_Vpot() 
    {  Adjusting = 0;
	   ctx.fillStyle = '#FFFFFF'; 
       ctx.fillRect(0, 0, rwidth, height); 	   
       Draw_Plotting();   
       plotPOTENTIAL(dR);  
       solveSchroed();	
	   //    OUTPUTS  
 	   handle_outputs();
	}
function Adjust_perturb()	
    {  Adjusting = 2; Perturb=1;
	   oldNsaved=Nsaved; 
	   Nsaved=0;
	   ctx.fillStyle = '#ff4'; 
       ctx.fillRect(0, 0, rwidth, height); 	   
       Draw_Plotting();   //  var Vpot_depth=1.5;   AND REMAINS CONSTANT
       OdR=dR; if(old) {OdR=Opd*dR;} ; plotPOTENTIAL(OdR);   // Original var Edge=2.0; var Steep=0.2;  
	   plotSquare(PertPos, Ebase-Vpot_depth);
	   plotSquare(PertLeft, Ebase-Vpot_depth);	 plotSquare(PertRight, Ebase-Vpot_depth); 
	   plotSquare(PertPos, Ebase+Vpot(PertPos)  );	
       //var Vpert=0;  var PertPos=0; var PertWidth=1; var PertLeft=0; var PertRight=0; var PertPI=1;
       //PertLeft=PertPos-PertWidth/2;  PertRight=PertPos-PertWidth/2; PertPI=Math.PI/PertWidth;
	}
function  plotSquare( xxx, yyy)
    {    
	    var boxedge=0.05;
	     Mline(xxx-boxedge,yyy-boxedge,xxx+boxedge,yyy-boxedge);
	     Mline(xxx+boxedge,yyy-boxedge,xxx+boxedge,yyy+boxedge);
	     Mline(xxx+boxedge,yyy+boxedge,xxx-boxedge,yyy+boxedge);
	     Mline(xxx-boxedge,yyy+boxedge,xxx-boxedge,yyy-boxedge);		 		 	
	}


function  goEnergy(  Inum )    //   SHOWING ONE OF THE SAVED ENERGIES
{
	        ctx.fillStyle = '#FFFFCC'; 
            ctx.fillRect(0, 0, rwidth, height);  
	        ctx.lineWidth = 1;ctx.strokeStyle = '#000';
				
           OdR=dR; if(old) {OdR=Opd*dR;} ; Draw_Plotting(); plotPOTENTIAL(OdR);   
		   
		   En=Energy[Inum];
	       ctx.lineWidth = 3;  ctx.strokeStyle = ColorsSaved[Inum];
		   solveSchroed();
	       ctx.lineWidth = 1;ctx.strokeStyle = '#000';		
		   display_Energy();
}

// -----------------------------------------------------------------------
function DoSavedEnergy( Inum )   //  SOLVING FOR Inum-th SAVED ENERGY VALUE
{
          //   tempEn=En;   This kept the energy unchanged
		   En=Energy[Inum];
	       ctx.lineWidth = 3;  ctx.strokeStyle = ColorsSaved[Inum];
		   solveSchroed();
	       ctx.lineWidth = 1;ctx.strokeStyle = '#000';	
		   display_Energy();		   	   
         //  En=tempEn;     This kept the energy unchanged 
}

// -----------------------------------------------------------------------
function RedoSavedEnergies()    //   SHOWING ALL THE THE SAVED ENERGIES
{  var inum=0;                  //   USED WHEN CLEANING THE SCREEN
   temEn=En;
   for (inum=0;inum<Nsaved;inum++)
   {
        DoSavedEnergy( inum );
   }
}


// -----------------------------------------------------------------------


// -----------------------------------------------------------------------
function Ruku()    //   One step in differential equation Runge-Kutta solution
{ 
// Variables for Ruku
//
// Runge Kutta for 2. order ODE - Schroedinger type
//
// R are the R-values
// F are function values   
// G are 1. derivative values
//  
// VARIABLES ALREADY DEFINED:
// var Rold=0;  var Fold=0; var Fnew=0; var Gold=0;  var  Gnew=0; 
// var Rmid=0;  var Gmid=0; var Fmid=0; var Vpotmid=0;   
  
  Rmid=Rold;
  Gmid=Gold;
  Fmid=Fold;
  Fnew=Fold;
  Gnew=Gold;
  Vpotmid=Vpot(Rmid);
  
  Akg[1]=dR*(Vpotmid-En)*InvMass*Fmid;
  Akf[1]=dR*Gmid;
  Fnew=Fnew+E6*Akf[1];
  Gnew=Gnew+E6*Akg[1];

  for (K=2; K< 5; K++)
   {
 
    Gmid=Gold+Akg[K-1]*Rkf[K];
    Fmid=Fold+Akf[K-1]*Rkf[K];
    Vpotmid=Vpot(Rmid);
    Akg[K]=dR*(Vpotmid-En)*InvMass*Fmid;
    Akf[K]=dR*Gmid;
    Rmid=Rold+dR*Rkf[K];
    Ah6=E6/Rkf[K];
    Gnew=Gnew+Ah6*Akg[K];
    Fnew=Fnew+Ah6*Akf[K]; 
   }
   Rnew=Rold+dR;
}
// -----------------------------------------------------------------------
//
function Vpot(R)                   //   Potential energy function
{ var Q=0; var T=0; 
  Q=-Vpot_depth*(1.0/(1.0+Math.exp((R-Edge)/Steep)));
  PertLeft=PertPos-PertWidth/2;  PertRight=PertPos+PertWidth/2; PertPI=Math.PI/PertWidth;
  if( ( R>PertLeft ) && ( R<PertRight ) && Perturb )
  {
    T = Math.cos( ( R - PertPos) * PertPI );
    Q=Q + Vpert* T * T;
  }
  return( Q );
}   
function Vpot0(R)                   //   Potential energy function without perturbation peak
{ var Q=0; var T=0; 
  Q=-Vpot_depth*(1.0/(1.0+Math.exp((R-Edge)/Steep)));
  return( Q );
}    
// -----------------------------------------------------------------------
function plotPOTENTIAL(ddR)
{
var iteri=0;
var Ro=0; var Rn=0;
var Fo=0;  var Fn=0;
         Fo=Vpot(Ro);
         for(iteri=0;iteri<100000;iteri++)
          {
             Rn=Ro+ddR;
             Fn=Vpot(Rn);
             Mline(Ro,Ebase+Fo,Rn,Ebase+Fn);
			 Ro=Rn;
			 Fo=Fn;
                      
           if ( Ro > 5.0 )  break;
         }
}

// -----------------------------------------------------------------------
function respond_mouse()
{
//   XmouseDOWN=0; YmouseDOWN=0;XmouseMOVED=0; YmouseMOVED=0; 
//   XmouseUP=0;YmouseUP=0;BUTTONdown=0; 
Event_Output="<small> mouseDOWN "+ XmouseDOWN+" "+YmouseDOWN + 
"  mouseUP "+ XmouseUP +" " + YmouseUP + "  mouseMOVED "+ XmouseMOVED +" " + YmouseMOVED + " BUTTON "+BUTTONdown;  //+"  EXP "+
   // (-0.5*(1.0/(1.0+Math.exp((1.0-Edge)/Steep))))+ 
   "</small><br>";
   var TESTING=0;
	  if ( TESTING )
	  { document.getElementById("EventView").innerHTML= Event_Output + "</small><br>"; }
}

//  Saved energies



//-1.4358655542595054
// -1.0026555727455
// -0.359966418603295

function do_fading(alpha, always)
    {
	 ctx.fillStyle = '#FFFFFF'; 
	 ctx.globalAlpha=alpha;
         ctx.fillRect(0, 0, rwidth, height); 
	 ctx.globalAlpha=1.0; 
	 fade_counter=fade_counter+1;
	 if (fade_counter>8 || always)
	 {   Draw_Plotting();
             plotPOTENTIAL(dR);	fade_counter=0; }
    }

function execute_commands(draw_yes)
{
 var TheCommandString = OurInputWindow.Executables.value;
 eval( TheCommandString );
 if ( draw_yes ) 
 {
 	    ctx.fillStyle = '#FFFFFF'; 
        ctx.fillRect(0, 0, rwidth, height);
		Draw_Plotting();
		plotPOTENTIAL(dR);    
		//  RedoSavedEnergies();
		solveSchroed();  
		draw_energy_pad();
		for (ksaved=0; ksaved< Nsaved; ksaved=ksaved+1 ) 
		       {       Add_Link_Energy( ksaved );   }      
 }
}
function handle_outputs()
{output_string="";
 output_string=output_string+"Vpot_depth=" + Vpot_depth + ";\n";
 output_string=output_string+"Edge=" + Edge + ";    ";
 output_string=output_string+"Steep=" + Steep + ";\n";
 
 output_string=output_string+"sepp=\"===================================\";\n";
 
 output_string=output_string+
              "Perturb=" + Perturb + ";    " +" Vpert=" + Vpert + "; \n";
 output_string=output_string+
              "PertPos=" + PertPos + ";    " +" PertWidth=" + PertWidth + "; \n";  
   
 output_string=output_string+"sepp=\"===================================\";\n";
 
 output_string=output_string+"Nsaved=" + Nsaved + ";\n"; 
 var lcounter=0;
 for (var kk=0;kk<Nsaved;kk=kk+1)
 {
   output_string=output_string+"Energy["+kk+"]=" + Energy[kk] + ";  ";
   lcounter=lcounter+1; 
   if(lcounter==2){output_string=output_string+"\n"; lcounter=0; } 
 }
 OurInputWindow.Outputs.value=output_string;
}

// Double Hump Potential
// Vpot_depth=1.5;
// Edge=0.5621333333333334;    Steep=0.4298666666666666;
// sepp="===================================";
// Perturb=1;     Vpert=-1.0497584723456739; 
// PertPos=2.1245333333333334;     PertWidth=2.5; 
// sepp="===================================";
// Nsaved=4;
// Energy[0]=-0.8911887350659337;  Energy[1]=-0.8460780040519326;  
// Energy[2]=-0.43358182144314333;  Energy[3]=-0.19483480062434275;  

function sort_energies()
{
   Energy= Energy.sort(function(a,b){return (a-b)});
   To_Energies="<br><small><b>Saved energies</b>" + sortlink;
   for (ks=0; ks< Nsaved; ks=ks+1 ) { Add_Link_Energy( ks );}  
}
function delete_energy(isaved)
{
   for (ks=isaved; ks< Nsaved-1; ks=ks+1 ) { Energy[ks] = Energy[ks+1];} 
   Nsaved = Nsaved-1;
   To_Energies="<br><small><b>Saved energies</b>" + sortlink;
   document.getElementById("SavedEnergies").innerHTML= To_Energies+"</small>";
   for (ks=0; ks< Nsaved; ks=ks+1 ) { Add_Link_Energy( ks );}    
}


</script>
</body>
</html>
